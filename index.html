<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Initiative Tracker</title>
    <!-- Google Fonts - Inter for primary text, Poppins for headings -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons CDN for sleek iconography -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="style.css">
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- Vanta.js Background Element -->
    <div id="vanta-background"></div>

    <div class="container">
        <div class="header-section">
            <h1>D&D Initiative Tracker</h1>
            <div class="round-turn-display">
                <p>Round: <span id="currentRound">1</span></p>
                <p>Turn: <span id="currentTurn">None</span></p>
            </div>
        </div>

        <div class="main-content-grid">
            <!-- Left Column: Combatants List & Add/Import -->
            <div class="left-column">
                <div class="combatant-management">
                    <h2>Combatant Management</h2>
                    <div class="button-group">
                        <button id="openPcModalBtn" class="button button-primary"><i data-lucide="user-plus"></i> Add PC</button>
                        <button id="openMonsterModalBtn" class="button button-primary"><i data-lucide="skull"></i> Add Monster</button>
                        <button id="importExportBtn" class="button button-neutral"><i data-lucide="arrow-right-left"></i> Import/Export</button>
                    </div>
                    <ul id="combatantsList">
                        <!-- Combatant items will be dynamically added here -->
                    </ul>
                </div>

                <div class="dice-roller">
                    <h2>Dice Roller</h2>
                    <div class="dice-roller-input-group">
                        <input type="text" id="diceNotation" class="input-field" placeholder="e.g., 1d20+5">
                        <button id="rollDiceBtn" class="button button-primary"><i data-lucide="dice"></i> Roll</button>
                    </div>
                    <div class="dice-shortcut-buttons">
                        <button class="dice-shortcut" data-roll="1d4">1d4</button>
                        <button class="dice-shortcut" data-roll="1d6">1d6</button>
                        <button class="dice-shortcut" data-roll="1d8">1d8</button>
                        <button class="dice-shortcut" data-roll="1d10">1d10</button>
                        <button class="dice-shortcut" data-roll="1d12">1d12</button>
                        <button class="dice-shortcut" data-roll="1d20">1d20</button>
                        <button class="dice-shortcut" data-roll="2d6">2d6</button>
                        <button class="dice-shortcut" data-roll="4d6kh3">4d6kh3</button>
                    </div>
                    <div id="rollResult"></div>
                </div>
            </div>

            <!-- Right Column: Initiative Tracker & Controls -->
            <div class="right-column">
                <div class="initiative-tracker">
                    <h2>Initiative Controls</h2>
                    <div class="initiative-controls button-group">
                        <button id="startCombatBtn" class="button button-success"><i data-lucide="play"></i> Start Combat</button>
                        <button id="nextTurnBtn" class="button button-primary"><i data-lucide="arrow-right"></i> Next Turn</button>
                        <button id="prevTurnBtn" class="button button-neutral"><i data-lucide="arrow-left"></i> Prev Turn</button>
                        <button id="resetCombatBtn" class="button button-danger"><i data-lucide="rotate-ccw"></i> Reset Combat</button>
                        <button id="clearMonstersBtn" class="button button-danger"><i data-lucide="skull"></i> Clear Monsters</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Section -->
        <div class="footer-section">
            <div class="patreon-promo">
                <p>Enjoying the tracker? Consider supporting its development!</p>
                <a href="https://www.patreon.com/jimpeccable" target="_blank" class="patreon-button" title="Support this project on Patreon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="heart" class="lucide lucide-heart"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg> Support on Patreon
                </a>
            </div>
            <p>&copy; 2024 D&D Initiative Tracker. All rights reserved.</p>
            <p>Made with <i data-lucide="heart" style="color: var(--color-red); width: 16px; height: 16px; vertical-align: middle;"></i> by Jimpeccable</p>
            <button id="premiumUnlockBtn" class="button button-neutral"><i data-lucide="key"></i> Premium Access</button>
        </div>
    </div>

    <!-- Modals -->

    <!-- PC Add Modal -->
    <div id="modal-pc-add" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal="modal-pc-add"><i data-lucide="x"></i></span>
            <h2>Add New PC</h2>
            <label for="pcNameInput">Name:</label>
            <input type="text" id="pcNameInput" class="input-field" placeholder="PC Name">
            <label for="pcInitiativeInput">Initiative:</label>
            <input type="number" id="pcInitiativeInput" class="input-field" placeholder="Initiative Score">
            <label for="pcHpInput">Max HP:</label>
            <input type="number" id="pcHpInput" class="input-field" placeholder="Max Hit Points">
            <div class="button-group">
                <button id="addPcBtn" class="button button-primary">Add PC</button>
            </div>
        </div>
    </div>

    <!-- Monster Add Modal -->
    <div id="modal-monster-add" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal="modal-monster-add"><i data-lucide="x"></i></span>
            <h2>Add New Monster</h2>
            <label for="monsterSearchInput">Search Monster:</label>
            <input type="text" id="monsterSearchInput" class="input-field" placeholder="Search by name (e.g., 'Goblin')">
            <div id="monsterSearchResults" class="monster-search-results">
                <!-- Search results will appear here -->
            </div>
            <label for="monsterNameInput">Monster Name (or custom):</label>
            <input type="text" id="monsterNameInput" class="input-field" placeholder="Monster Name">
            <label for="monsterInitiativeInput">Initiative:</label>
            <input type="number" id="monsterInitiativeInput" class="input-field" placeholder="Initiative Score">
            <label for="monsterHpInput">Max HP:</label>
            <input type="number" id="monsterHpInput" class="input-field" placeholder="Max Hit Points">
            <label for="monsterCountInput">Number of Monsters:</label>
            <input type="number" id="monsterCountInput" class="input-field" value="1" min="1">
            <div class="button-group">
                <button id="addMonsterBtn" class="button button-primary">Add Monster(s)</button>
            </div>
        </div>
    </div>

    <!-- Edit Combatant Modal -->
    <div id="modal-edit-combatant" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal="modal-edit-combatant"><i data-lucide="x"></i></span>
            <h2>Edit Combatant</h2>
            <p>Editing: <strong id="editCombatantNameDisplay"></strong></p>

            <label for="editHpInput">Current HP:</label>
            <input type="number" id="editHpInput" class="input-field">
            <div class="button-group">
                <button id="applyHpChangeBtn" class="button button-primary">Apply HP Change</button>
            </div>

            <label for="editInitiativeInput">Initiative:</label>
            <input type="number" id="editInitiativeInput" class="input-field">
            <div class="button-group">
                <button id="applyInitiativeChangeBtn" class="button button-primary">Apply Initiative Change</button>
            </div>

            <h3>Conditions</h3>
            <ul id="activeConditionsList">
                <!-- Active conditions will be listed here -->
            </ul>
            <div class="button-group">
                <button id="openAddConditionModalBtn" class="button button-neutral"><i data-lucide="plus-circle"></i> Add Condition</button>
            </div>
            <div class="button-group" style="justify-content: space-between;">
                <button id="deleteCombatantBtn" class="button button-danger"><i data-lucide="trash-2"></i> Delete Combatant</button>
                <button id="closeEditModalBtn" class="button button-neutral">Close</button>
            </div>
        </div>
    </div>

    <!-- Condition Description Modal -->
    <div id="modal-condition-description" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal="modal-condition-description"><i data-lucide="x"></i></span>
            <h2 id="conditionDescriptionTitle"></h2>
            <div id="conditionDescriptionContent" style="text-align: left;">
                <!-- Condition description will be loaded here -->
            </div>
            <div class="button-group">
                <button class="button button-neutral" onclick="closeModal(document.getElementById('modal-condition-description'))">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Condition Modal -->
    <div id="modal-add-condition" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal="modal-add-condition"><i data-lucide="x"></i></span>
            <h2>Add Condition</h2>
            <label for="conditionSearchInput">Search Condition:</label>
            <input type="text" id="conditionSearchInput" class="input-field" placeholder="Search by name (e.g., 'Blinded')">
            <div id="conditionSearchResults" class="monster-search-results">
                <!-- Search results will appear here -->
            </div>
            <label for="conditionDurationInput">Duration (Rounds, 0 for permanent):</label>
            <input type="number" id="conditionDurationInput" class="input-field" value="0" min="0">
            <div class="button-group">
                <button id="addConditionToCombatantBtn" class="button button-primary">Add Condition</button>
            </div>
        </div>
    </div>

    <!-- Clear Monsters Confirmation Modal -->
    <div id="modal-clear-confirmation" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal="modal-clear-confirmation"><i data-lucide="x"></i></span>
            <h2>Confirm Clear Monsters</h2>
            <p>Are you sure you want to clear all monsters from the combat tracker? This action cannot be undone.</p>
            <div class="button-group">
                <button id="confirmClearBtn" class="button button-danger">Clear All Monsters</button>
                <button id="cancelClearBtn" class="button button-neutral">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Monster Full Details Modal -->
    <div id="modal-monster-full-details" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal="modal-monster-full-details"><i data-lucide="x"></i></span>
            <h2 id="monsterDetailsTitle"></h2>
            <div id="monsterDetailsContent">
                <!-- Monster full details will be loaded here -->
            </div>
            <div class="button-group">
                <button class="button button-neutral" onclick="closeModal(document.getElementById('modal-monster-full-details'))">Close</button>
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="modal-message" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal="modal-message"><i data-lucide="x"></i></span>
            <h2 id="messageModalTitle"></h2>
            <p id="messageModalText"></p>
            <div class="button-group">
                <button class="button button-primary" onclick="closeModal(document.getElementById('modal-message'))">OK</button>
            </div>
        </div>
    </div>

    <!-- Premium Unlock Modal -->
    <div id="modal-premium-unlock" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal="modal-premium-unlock"><i data-lucide="x"></i></span>
            <h2>Unlock Premium Features</h2>
            <p>Enter the monthly unlock code to access premium features.</p>
            <label for="premiumCodeInput">Monthly Code:</label>
            <input type="text" id="premiumCodeInput" class="input-field" placeholder="Enter 8-character code">
            <div id="premiumUnlockMessage" class="message-area"></div>
            <button id="submitPremiumCodeBtn" class="button button-primary">Unlock</button>
        </div>
    </div>


    <!-- Vanta.js Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.cells.min.js"></script>
    <script>
        // Initialize Vanta.js background
        VANTA.CELLS({
            el: "#vanta-background",
            mouseControls: true,
            touchControls: true,
            gyroControls: false,
            minHeight: 200.00,
            minWidth: 200.00,
            scale: 1.00,
            color1: 0x1A1A1A, // Darker color
            color2: 0x303030 // Lighter dark color
        });
    </script>

    <!-- Lucide Icons Initialization -->
    <script>
        lucide.createIcons();
    </script>

    <!-- Main Application Script -->
    <script src="script.js"></script>
</body>
</html>
